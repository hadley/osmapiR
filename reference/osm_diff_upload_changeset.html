<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="With this API call files in the OsmChange format can be uploaded to
the server. This is guaranteed to be running in a transaction. So either all the changes are applied or none."><title>Diff (OsmChange format) upload to a changeset — osm_diff_upload_changeset • osmapiR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diff (OsmChange format) upload to a changeset — osm_diff_upload_changeset"><meta property="og:description" content="With this API call files in the OsmChange format can be uploaded to
the server. This is guaranteed to be running in a transaction. So either all the changes are applied or none."><meta property="og:image" content="https://jmaspons.github.io/osmapiR/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">osmapiR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.30</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how_to_edit_osm.html">How to edit OpenStreetMap</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jmaspons/osmapiR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Diff (OsmChange format) upload to a changeset</h1>
      <small class="dont-index">Source: <a href="https://github.com/jmaspons/osmapiR/blob/HEAD/R/osmapi_changesets.R" class="external-link"><code>R/osmapi_changesets.R</code></a></small>
      <div class="d-none name"><code>osm_diff_upload_changeset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>With this API call files in the <a href="https://wiki.openstreetmap.org/wiki/OsmChange" class="external-link">OsmChange</a> format can be uploaded to
the server. This is guaranteed to be running in a transaction. So either all the changes are applied or none.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">osm_diff_upload_changeset</span><span class="op">(</span><span class="va">changeset_id</span>, <span class="va">osmcha</span>, format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"xml"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>changeset_id</dt>
<dd><p>The ID of the changeset this diff belongs to. The user issuing this API call has to be the same
that created the changeset.</p></dd>


<dt>osmcha</dt>
<dd><p>The OsmChange data. Can be the path of an OsmChange file, a <code>xml_document</code> or an <code>osmapi_OsmChange</code>
object (see <code>osmchange_*()</code> functions).</p></dd>


<dt>format</dt>
<dd><p>Format of the output. Can be <code>R</code> (default) or <code>xml</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If a diff is successfully applied and <code>format = "R"</code>, it returns a data frame with one row for each edited object.
For <code>format = "xml"</code>, a xml2::xml_document is returned in the following
format:</p>


<p></p><div class="sourceCode xml"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>&lt;<span class="kw">diffResult</span><span class="ot"> generator=</span><span class="st">"OpenStreetMap Server"</span><span class="ot"> version=</span><span class="st">"0.6"</span>&gt;</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    &lt;<span class="kw">node</span><span class="er">|</span><span class="ot">way</span><span class="er">|relation</span> <span class="er">old_id</span><span class="ot">=</span><span class="st">"#"</span><span class="ot"> new_id=</span><span class="st">"#"</span><span class="ot"> new_version=</span><span class="st">"#"</span>/&gt;</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    ...</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>&lt;/<span class="kw">diffResult</span>&gt;</span></code></pre><p></p></div>



<p>with one element for every object in the upload.</p>


<p>Note that this can be counter-intuitive when the same element has appeared multiple times in the input then it will
appear multiple times in the output.</p><table class="table table"><tr><td><strong>Attribute</strong></td><td><strong>create</strong></td><td><strong>modify</strong></td><td><strong>delete</strong></td></tr><tr><td><strong>old_id</strong></td><td>same as uploaded element</td><td>same as uploaded element</td><td>same as uploaded element</td></tr><tr><td><strong>new_id</strong></td><td>new ID</td><td>new ID ''or'' same as uploaded</td><td>not present</td></tr><tr><td><strong>new_version</strong></td><td>new version</td><td>new version</td><td>not present</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To upload an OSC file it has to conform to the <a href="https://wiki.openstreetmap.org/wiki/OsmChange" class="external-link">OsmChange</a>
specification with the following differences:</p><ul><li><p>each element must carry a <code>changeset</code> and a <code>version</code> attribute (xml) / column (data.frame), except when you are
creating an element where the version is not required as the server sets that for you. The <code>changeset</code> must be the
same as the changeset ID being uploaded to.</p></li>
<li><p>a <code>&lt;delete&gt;</code> block in the OsmChange document may have an <code>if-unused</code> attribute (the value of which is ignored)
(<code>action_type</code> column with <code>delete if-unused</code> for data.frames). If this attribute is present, then the delete
operation(s) in this block are conditional and will only be executed if the object to be deleted is not used by
another object. Without the <code>if-unused</code>, such a situation would lead to an error, and the whole diff upload would
fail. Setting the attribute will also cause deletions of already deleted objects to not generate an error.</p></li>
<li><p><a href="https://wiki.openstreetmap.org/wiki/OsmChange" class="external-link">OsmChange</a> documents generally have <code>user</code> and <code>uid</code> attributes
on each element. These are not required in the document uploaded to the API.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    
<ul><li><p>Processing stops at the first error, so if there are multiple conflicts in one diff upload, only the first problem
is reported.</p></li>
<li><p>Refer to <code><a href="osm_capabilities.html">osm_capabilities()</a></code> --&gt; <code>changesets$maximum_elements</code> for the maximum number of changes permitted in a
changeset.</p></li>
<li><p>There is currently no limit in the diff size on the Rails port. CGImap limits diff size to 50MB (uncompressed
size).</p></li>
<li><p>Forward referencing of placeholder ids is not permitted and will be rejected by the API.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other edit changeset's functions: 
<code><a href="osm_create_changeset.html">osm_create_changeset</a>()</code></p>
<p>Other OsmChange's functions: 
<code><a href="osm_download_changeset.html">osm_download_changeset</a>()</code>,
<code><a href="osmchange_create.html">osmchange_create</a>()</code>,
<code><a href="osmchange_delete.html">osmchange_delete</a>()</code>,
<code><a href="osmchange_modify.html">osmchange_modify</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"how_to_edit_osm"</span>, package <span class="op">=</span> <span class="st">"osmapiR"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>vignette ‘how_to_edit_osm’ not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joan Maspons.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

